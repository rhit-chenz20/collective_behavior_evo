---
title: "plot genotype data for multiple models"
author: "Andrea Chen"
date: "`r Sys.Date()`"
output: pdf_document
---

# parameters for plotting
```{r setup, include=FALSE}
wd_path <- normalizePath(dirname(rstudioapi::getActiveDocumentContext()$path))
setwd(wd_path)
base_plot_folder <- "../plots/discrete_sociality"
hcl_color_palette <- "Dark 2" # color pattern for lines 
```

# load genotype data
```{r}
genotype_df <- readRDS("../r_data/dsicrete_evolve_sociality/genotypes.rds")
```

```{r}
phenotype_df <- readRDS("../r_data/dsicrete_evolve_sociality/phenotypes.rds")
```

```{r}
psis_df <- readRDS("../r_data/dsicrete_evolve_sociality/psis.rds")
```

```{r}
fitness_df <- readRDS("../r_data/dsicrete_evolve_sociality/fitnesses.rds")
```

```{r}
# regs <- c("fit", "ext", "ave", "inv")
# regs <- c("inv")
regs <- c("fit", "ext", "ave")
n <- 20
shift_size <- 120

sub_df <- phenotype_df
data_label <- "Phenotype"
labels <- list(title = paste("Averaged", data_label, "Distribution"),
                    x = paste(data_label, "value"), y = "Proportion")

bin_breaks <- seq(60, 140, by = 1)
ylim <- c(0, 0.1)

gen <- 10100
plot_rep <- FALSE

plot_dist()
```

```{r}
# regs <- c("fit", "ext", "ave", "inv")
regs <- c("inv")
# regs <- c("fit", "ext", "ave")
n <- 2
shift_size <- 120

sub_df <- genotype_df
data_label <- "Genotype"
labels <- list(title = paste("Averaged", data_label, "Distribution"),
                    x = paste(data_label, "value"), y = "Proportion")

bin_breaks <- seq(50, 150, by = 1)
ylim <- c(0, 0.1)

gen <- 10100
plot_rep <- FALSE

plot_dist()
```

```{r}
regs <- c("fit", "ext", "ave", "inv")
# regs <- c("inv")
# regs <- c("fit", "ext", "ave")
n <- 20
shift_size <- 120

sub_df <- fitness_df
data_label <- "Fitness"
labels <- list(title = paste("Averaged", data_label, "Distribution"),
                    x = paste(data_label, "value"), y = "Proportion")

bin_breaks <- seq(0.005, 0.01, by = 0.0001)
ylim <- c(0, 0.5)

gen <- 10100
plot_rep <- FALSE

plot_dist()
```

```{r}
# regs <- c("fit", "ext", "ave", "inv")
regs <- c("inv")
# regs <- c("fit", "ext", "ave")
n <- 8
shift_size <- 120

sub_df <- psis_df
data_label <- "Psi"
labels <- list(title = paste("Averaged", data_label, "Distribution"),
                    x = paste(data_label, "value"), y = "Proportion")

bin_breaks <- seq(-0.001, 0.01, by = 0.0001)
ylim <- c(0, 1)

gen <- 9999
plot_rep <- TRUE

plot_dist()
```

# multimodel distribution plot
```{r}
plot_dist <- function(){
    out_dir  <- file.path(base_plot_folder, sprintf("%s_distribution", data_label))
    if (!dir.exists(out_dir)) dir.create(out_dir, recursive = TRUE)

    for (r in regs){
        out_dir  <- file.path(base_plot_folder, sprintf("%s_distribution/reg_%s", data_label, r))
        if (!dir.exists(out_dir)) dir.create(out_dir, recursive = TRUE)

        data_filter <- list(list(reg=r, n=n, shift_size=shift_size, spsi=0.0),
                list(reg=r, n=n, shift_size=shift_size, spsi=0.1),
                list(reg=r, n=n, shift_size=shift_size, spsi=0.5))

        legend_label <- c(expression(psi==0.0), expression(psi==0.1), expression(psi==0.5))
        cols <- hcl.colors(length(data_filter), palette = hcl_color_palette)
        out_file <- file.path(out_dir, sprintf("dist_lines_gen_%s_reg_%s_n_%d_shift_%d.png", gen, r,n,shift_size))
        png(filename = out_file, width = 1800, height = 1400, res = 200)  # ~6x4.7" at 300 dpi

        for (i in 1:length(data_filter)){
            f <- data_filter[[i]]
            c <- cols[i]
            overlay <- (i>1)

            res <- plot_rep_binned_mean_line(
                df = sub_df,
                filter = f,
                generation = gen,
                breaks = bin_breaks,
                labels = labels,
                ylim = ylim,
                add = overlay,
                col = c, lwd = 2,
                plot_rep = plot_rep
            )
        }

        legend("topright", bty = "n",
            legend = legend_label,
            col = cols, lwd = 2)

        dev.off()
    }
}
```

```{r}
unique(fitness_df$n)
```

